<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EngVoca - ì˜ì–´ë‹¨ì–´ í•™ìŠµ</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&family=DM+Serif+Display&family=JetBrains+Mono:wght@400;600&family=Noto+Sans:wght@400;500&display=swap" rel="stylesheet">
<style>
:root{--bg:#f5f7fb;--surface:#ffffff;--surface2:#eef1f6;--accent:#5b6abf;--accent-light:#7c8ad9;--green:#2eaa7f;--red:#d9534f;--text:#2c2c3a;--text-dim:#7a8194;--card-radius:20px;--shadow:0 2px 12px rgba(0,0,0,.06)}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Noto Sans KR',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden}
body::before{content:'';position:fixed;top:-30%;left:-10%;width:60vw;height:60vw;background:radial-gradient(circle,rgba(91,106,191,.07) 0%,transparent 70%);pointer-events:none;z-index:0}
body::after{content:'';position:fixed;bottom:-20%;right:-10%;width:50vw;height:50vw;background:radial-gradient(circle,rgba(46,170,127,.05) 0%,transparent 70%);pointer-events:none;z-index:0}
.app{position:relative;z-index:1;max-width:520px;margin:0 auto;padding:20px 16px 40px}

.header{text-align:center;padding:24px 0 20px}
.header h1{font-family:'DM Serif Display',serif;font-size:2rem;letter-spacing:2px;background:linear-gradient(135deg,var(--accent),var(--green));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.header h1 span{font-family:'DM Serif Display',serif;font-size:1.4rem}
.header p{color:var(--text-dim);font-size:.85rem;margin-top:4px}

.loading{text-align:center;padding:60px 20px;color:var(--text-dim)}
.loading-spinner{width:40px;height:40px;border:3px solid var(--surface2);border-top-color:var(--accent);border-radius:50%;animation:spin .8s linear infinite;margin:0 auto 16px}
@keyframes spin{to{transform:rotate(360deg)}}

/* â”€â”€ Day ì„ íƒ í™”ë©´ â”€â”€ */
.day-select-screen{display:none}
.day-select-title{font-size:1rem;font-weight:700;margin-bottom:14px;color:var(--text)}
.day-grid{display:grid;grid-template-columns:repeat(auto-fill, minmax(72px, 1fr));gap:8px}
.day-grid-btn{padding:14px 4px;border:1px solid rgba(0,0,0,.08);border-radius:14px;background:var(--surface);color:var(--text);font-family:'Noto Sans KR',sans-serif;font-size:.85rem;font-weight:600;cursor:pointer;transition:all .25s;box-shadow:var(--shadow);text-align:center}
.day-grid-btn:hover{border-color:var(--accent);color:var(--accent);background:#f0f2ff}
.day-grid-btn:active{background:var(--accent);color:#fff;border-color:var(--accent)}

/* â”€â”€ í•™ìŠµ í™”ë©´ â”€â”€ */
.study-screen{display:none}

.btn-back{position:fixed;top:16px;left:16px;z-index:100;padding:8px 14px;border:1px solid rgba(0,0,0,.06);border-radius:12px;background:var(--surface);color:var(--text-dim);font-family:'Noto Sans KR',sans-serif;font-size:.82rem;font-weight:500;cursor:pointer;transition:all .2s;box-shadow:var(--shadow);white-space:nowrap;display:none}
.btn-back:hover{background:var(--accent);color:#fff;border-color:var(--accent)}

.day-title{text-align:left;font-size:.84rem;color:var(--accent);font-weight:500;margin-bottom:16px;padding:10px 16px;background:rgba(91,106,191,.06);border-radius:10px;line-height:1.5}
.day-title-grid{display:grid;grid-template-columns:1fr 1fr;gap:4px 16px}
.day-title-item{display:flex;gap:4px}
.day-title-item strong{color:var(--text);min-width:60px;display:inline-block;font-weight:700}

/* Card */
.card-area{margin-bottom:16px}
.card{position:relative;width:100%;min-height:340px;border-radius:var(--card-radius);padding:60px 28px 32px;border:1px solid rgba(0,0,0,.06);box-shadow:var(--shadow);background:linear-gradient(145deg,#ffffff,#f0f3f8);display:flex;flex-direction:column;align-items:center;justify-content:flex-start}
.card-top-bar{position:absolute;top:16px;left:16px;right:16px;display:flex;justify-content:space-between;z-index:5}
.card-btn{width:40px;height:40px;border-radius:12px;border:1px solid rgba(0,0,0,.08);background:var(--surface);color:var(--text-dim);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;font-size:1.1rem;box-shadow:var(--shadow)}
.card-btn:hover{background:var(--surface2);color:var(--text)}
.card-btn.speaking{color:var(--accent);border-color:var(--accent);background:rgba(91,106,191,.08)}
.card-btn.starred{color:#f0a500;border-color:#f0a500;background:rgba(240,165,0,.08)}
.card-word{font-family:'DM Serif Display',serif;font-size:2.6rem;letter-spacing:1px;text-align:center;margin-bottom:6px}
.card-ipa{font-size:.95rem;color:var(--text-dim);text-align:center;margin-bottom:20px;font-family:'Noto Sans',sans-serif}
.card-meanings{width:100%}
.meaning-group{width:100%;margin-bottom:10px;display:flex;align-items:baseline;gap:8px;flex-wrap:wrap}.meaning-group:last-child{margin-bottom:0}
.pos-tag{display:inline-block;background:var(--accent);color:#fff;font-size:.7rem;font-weight:700;padding:3px 10px;border-radius:20px;flex-shrink:0}
.def-inline{font-size:1rem;line-height:1.6;color:var(--text)}

/* Navigation */
.card-nav{display:flex;gap:8px;margin-bottom:12px}
.card-nav button{flex:1;padding:13px 4px;border:1px solid rgba(0,0,0,.06);border-radius:14px;font-family:'Noto Sans KR',sans-serif;font-size:.85rem;font-weight:500;cursor:pointer;transition:all .2s;background:var(--surface);color:var(--text);box-shadow:var(--shadow)}
.card-nav button:hover:not(:disabled){background:var(--accent);color:#fff;border-color:var(--accent)}
.card-nav button:disabled{opacity:.35;cursor:default;background:var(--surface2);color:var(--text-dim);border-color:rgba(0,0,0,.04);box-shadow:none}
.card-counter{text-align:center;font-size:.82rem;color:var(--text-dim);font-family:'JetBrains Mono',monospace}

/* Settings */
.settings-toggle{position:fixed;top:16px;right:16px;z-index:100;width:40px;height:40px;border-radius:12px;background:var(--surface);border:1px solid rgba(0,0,0,.06);color:var(--text-dim);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;box-shadow:var(--shadow)}
.settings-toggle:hover{color:var(--text);background:var(--surface2)}
.settings-toggle svg{width:20px;height:20px}
.settings-panel{display:none;position:fixed;inset:0;z-index:200;background:rgba(0,0,0,.3);backdrop-filter:blur(8px);padding:20px;overflow-y:auto}
.settings-panel.open{display:flex;align-items:center;justify-content:center}
.settings-content{background:var(--surface);border-radius:var(--card-radius);padding:32px 24px;width:100%;max-width:460px;border:1px solid rgba(0,0,0,.08);box-shadow:0 8px 40px rgba(0,0,0,.12)}
.settings-title{font-size:1.2rem;font-weight:700;margin-bottom:20px}
.setting-row{display:flex;align-items:center;justify-content:space-between;padding:14px 0;border-bottom:1px solid rgba(0,0,0,.06)}
.setting-label{font-size:.9rem}
.setting-label span{display:block;font-size:.75rem;color:var(--text-dim);margin-top:2px}
.setting-select{background:var(--surface2);border:1px solid rgba(0,0,0,.08);border-radius:10px;padding:8px 14px;color:var(--text);font-family:'Noto Sans KR',sans-serif;font-size:.85rem}
.btn-close-settings{margin-top:20px;width:100%;padding:12px;background:var(--accent);color:#fff;border:none;border-radius:12px;font-family:'Noto Sans KR',sans-serif;font-size:.9rem;cursor:pointer}
.btn-reload{margin-top:10px;width:100%;padding:12px;background:var(--surface2);color:var(--text);border:1px solid rgba(0,0,0,.08);border-radius:12px;font-family:'Noto Sans KR',sans-serif;font-size:.85rem;cursor:pointer;transition:all .2s}
.btn-reload:hover{background:var(--accent);color:#fff;border-color:var(--accent)}

@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
.fade-up{animation:fadeUp .4s ease both}

@media(max-width:400px){.card-word{font-size:2rem}.card-nav button{font-size:.78rem;padding:11px 2px}.day-grid{grid-template-columns:repeat(auto-fill, minmax(64px, 1fr));gap:6px}.day-grid-btn{padding:12px 2px;font-size:.8rem}}
</style>
</head>
<body>

<button class="btn-back" id="btnBack" onclick="goBackToSelect()">â† ëŒì•„ê°€ê¸°</button>

<button class="settings-toggle" onclick="toggleSettings()">
  <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M12 15a3 3 0 100-6 3 3 0 000 6z"/><path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 01-2.83 2.83l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.68 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 012.83-2.83l.06.06A1.65 1.65 0 009 4.68a1.65 1.65 0 001-1.51V3a2 2 0 014 0v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 2.83l-.06.06A1.65 1.65 0 0019.4 9a1.65 1.65 0 001.51 1H21a2 2 0 010 4h-.09a1.65 1.65 0 00-1.51 1z"/></svg>
</button>

<div class="settings-panel" id="settingsPanel">
  <div class="settings-content">
    <div class="settings-title">âš™ï¸ ì„¤ì •</div>
    <div class="setting-row">
      <div class="setting-label">ë‹¨ì–´ ìˆœì„œ<span>í•™ìŠµ ìˆœì„œ ì„¤ì •</span></div>
      <select class="setting-select" id="wordOrder">
        <option value="sequential" selected>ìˆœì„œëŒ€ë¡œ</option>
        <option value="random">ëœë¤</option>
      </select>
    </div>
    <div class="setting-row" style="flex-direction:column;align-items:stretch">
      <div class="setting-label" style="margin-bottom:8px">ë°œìŒ ëª©ì†Œë¦¬ (TTS ìŒì„± ì„ íƒ)</div>
      <select class="setting-select" id="voiceSelect" style="width:100%"></select>
    </div>
    <div class="setting-row">
      <div class="setting-label">ëŠë¦° ë°œìŒ ì†ë„<span>ë‘ ë²ˆì§¸ íƒ­ ì‹œ ì¬ìƒ ì†ë„</span></div>
      <select class="setting-select" id="slowSpeed">
        <option value="0.1">0.1x</option>
        <option value="0.2">0.2x</option>
        <option value="0.3">0.3x</option>
        <option value="0.4">0.4x</option>
        <option value="0.5" selected>0.5x</option>
        <option value="0.6">0.6x</option>
        <option value="0.7">0.7x</option>
      </select>
    </div>
    <button class="btn-reload" onclick="reloadDays()">ğŸ”„ Day íŒŒì¼ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
    <button class="btn-close-settings" onclick="toggleSettings()">ë‹«ê¸°</button>
  </div>
</div>

<div class="app">
  <div class="header fade-up">
    <h1>EngVoca<span id="headerDayLabel"></span></h1>
    <p>ì˜ì–´ë‹¨ì–´ í•™ìŠµ í”„ë¡œê·¸ë¨</p>
  </div>

  <div class="loading" id="loadingScreen">
    <div class="loading-spinner"></div>
    <div>Day íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
  </div>

  <!-- Day ì„ íƒ í™”ë©´ -->
  <div class="day-select-screen" id="daySelectScreen">
    <div class="day-select-title fade-up">ğŸ“š í•™ìŠµí•  Dayë¥¼ ì„ íƒí•˜ì„¸ìš”</div>
    <div class="day-grid fade-up" style="animation-delay:.1s" id="dayGrid"></div>
  </div>

  <!-- í•™ìŠµ í™”ë©´ -->
  <div class="study-screen" id="studyScreen">
    <div class="day-title" id="dayTitle" style="display:none"></div>

    <div class="card-area fade-up" style="animation-delay:.1s">
      <div class="card" id="card">
        <div class="card-top-bar">
          <button class="card-btn" id="btnSpeak" onclick="speakWord(event)" title="ë°œìŒ ë“£ê¸°">ğŸ”Š</button>
          <button class="card-btn" id="btnStar" onclick="toggleStar(event)" title="ì¤‘ìš” ë‹¨ì–´">â˜†</button>
        </div>
        <div class="card-word" id="cardWord">-</div>
        <div class="card-ipa" id="cardIpa"></div>
        <div class="card-meanings" id="cardMeanings"></div>
      </div>
    </div>

    <div class="card-nav fade-up" style="animation-delay:.15s">
      <button onclick="goFirst()" id="btnFirst">â—€â—€ ì²˜ìŒ</button>
      <button onclick="goPrev()" id="btnPrev">â—€ ì´ì „</button>
      <button onclick="goNext()" id="btnNext">ë‹¤ìŒ â–¶</button>
      <button onclick="goLast()" id="btnLast">ë â–¶â–¶</button>
    </div>

    <div class="card-counter fade-up" style="animation-delay:.2s" id="cardCounter">1 / 25</div>
  </div>
</div>

<script>
let dayData = [];
let allWords = [];
let studyWords = [];
let currentDayIndex = 0;
let currentIndex = 0;
let speakCount = 0;

// ì¤‘ìš” ë‹¨ì–´
function getStarredWords() {
  try { return JSON.parse(localStorage.getItem('engvoca_starred') || '[]'); } catch { return []; }
}
function saveStarredWords(arr) { localStorage.setItem('engvoca_starred', JSON.stringify(arr)); }
function isStarred(word) { return getStarredWords().includes(word); }

// TTS ìŒì„±
let voices = [];
let voiceLoadAttempts = 0;
function loadVoices() {
  const allVoices = speechSynthesis.getVoices();
  voices = allVoices.filter(v => /^en[-_]/i.test(v.lang));
  const sel = document.getElementById('voiceSelect');
  sel.innerHTML = '';
  const defaultOpt = document.createElement('option');
  defaultOpt.value = '-1';
  defaultOpt.textContent = 'ğŸ“± ê¸°ê¸° ê¸°ë³¸ ìŒì„±';
  sel.appendChild(defaultOpt);
  voices.forEach((v, i) => {
    const opt = document.createElement('option');
    const female = /Female|female|Samantha|Victoria|Zira|Hazel|Susan|Karen|Moira|Fiona/i.test(v.name);
    const male = /Male|male|Daniel|David|Mark|Alex|Fred|Tom|James/i.test(v.name);
    opt.value = i;
    opt.textContent = `${female ? 'ğŸ‘© ' : male ? 'ğŸ‘¨ ' : ''}${v.name} (${v.lang})`;
    sel.appendChild(opt);
  });
  if (voices.length === 0 && voiceLoadAttempts < 10) {
    voiceLoadAttempts++;
    setTimeout(loadVoices, 300);
  }
}
if (typeof speechSynthesis !== 'undefined') {
  speechSynthesis.onvoiceschanged = loadVoices;
  loadVoices();
}
function getSelectedVoice() {
  const idx = parseInt(document.getElementById('voiceSelect').value);
  if (idx < 0 || isNaN(idx)) return null;
  return voices[idx] || null;
}

function speakWord(e) {
  if (e) { e.stopPropagation(); e.preventDefault(); }
  const word = studyWords[currentIndex]; if (!word) return;
  const btn = document.getElementById('btnSpeak');
  const synth = window.speechSynthesis; synth.cancel();
  const utter = new SpeechSynthesisUtterance(word.en);
  utter.lang = 'en-US';
  const voice = getSelectedVoice();
  if (voice) utter.voice = voice;
  if (speakCount === 0) { utter.rate = 1.0; speakCount = 1; }
  else { utter.rate = parseFloat(document.getElementById('slowSpeed').value) || 0.5; speakCount = 0; }
  btn.classList.add('speaking');
  utter.onend = () => btn.classList.remove('speaking');
  utter.onerror = () => btn.classList.remove('speaking');
  setTimeout(() => btn.classList.remove('speaking'), 3000);
  synth.speak(utter);
}

function toggleStar(e) {
  if (e) { e.stopPropagation(); e.preventDefault(); }
  const word = studyWords[currentIndex]; if (!word) return;
  let starred = getStarredWords();
  const btn = document.getElementById('btnStar');
  if (starred.includes(word.en)) {
    starred = starred.filter(w => w !== word.en);
    btn.textContent = 'â˜†'; btn.classList.remove('starred');
  } else {
    starred.push(word.en);
    btn.textContent = 'â˜…'; btn.classList.add('starred');
  }
  saveStarredWords(starred);
}

// ë‚´ì¥ ê¸°ë³¸ ë°ì´í„°
const embeddedDays = [
  {"day":1,"title":"pro-/pre-, in-, out-/ut-/il-","words":[{"en":"progress","ipa":"/ËˆprÉ‘ËÉ¡res/","meanings":[{"pos":"ëª…","defs":["ì§„ë³´, ë°œì „"]},{"pos":"ë™","defs":["ì „ì§„í•˜ë‹¤, ë°œë‹¬í•˜ë‹¤"]}]},{"en":"propose","ipa":"/prÉ™ËˆpoÊŠz/","meanings":[{"pos":"ë™","defs":["ì œì•ˆí•˜ë‹¤","(ê²°í˜¼ì„) ì‹ ì²­í•˜ë‹¤"]}]}]}
];

// Day ë¡œë“œ
async function loadAllDays() {
  document.getElementById('loadingScreen').style.display = 'block';
  document.getElementById('daySelectScreen').style.display = 'none';
  document.getElementById('studyScreen').style.display = 'none';
  dayData = []; allWords = [];
  let dayNum = 1;
  while (true) {
    try {
      const res = await fetch(`day/day${dayNum}.json`);
      if (!res.ok) break;
      const data = await res.json();
      dayData.push({ day: dayNum, title: data.title || '', words: data.words || [] });
      dayNum++;
    } catch (e) { break; }
  }
  if (dayData.length === 0) dayData = embeddedDays;
  allWords = []; dayData.forEach(d => { allWords = allWords.concat(d.words); });
  document.getElementById('loadingScreen').style.display = 'none';
  showDaySelectScreen();
}

async function reloadDays() { toggleSettings(); await loadAllDays(); }

// Day ì„ íƒ í™”ë©´
function showDaySelectScreen() {
  document.getElementById('daySelectScreen').style.display = 'block';
  document.getElementById('studyScreen').style.display = 'none';
  const grid = document.getElementById('dayGrid');
  grid.innerHTML = '';
  dayData.forEach((d, i) => {
    const btn = document.createElement('button');
    btn.className = 'day-grid-btn';
    btn.textContent = `Day ${d.day}`;
    btn.onclick = () => enterStudy(i);
    grid.appendChild(btn);
  });
}

// í•™ìŠµ í™”ë©´ ì§„ì…
function enterStudy(index) {
  currentDayIndex = index;
  document.getElementById('daySelectScreen').style.display = 'none';
  document.getElementById('studyScreen').style.display = 'block';
  document.getElementById('btnBack').style.display = 'block';
  const dayNum = String(dayData[index].day).padStart(2, '0');
  document.getElementById('headerDayLabel').textContent = ` : Day ${dayNum}`;
  updateDayTitle();
  startStudy();
}

// ëŒì•„ê°€ê¸°
function goBackToSelect() {
  window.speechSynthesis.cancel();
  document.getElementById('btnBack').style.display = 'none';
  document.getElementById('headerDayLabel').textContent = '';
  showDaySelectScreen();
}

function updateDayTitle() {
  const d = dayData[currentDayIndex];
  const el = document.getElementById('dayTitle');
  if (d.title) {
    const parts = d.title.split('/').map(s => s.trim()).filter(s => s);
    let html = '<div class="day-title-grid">';
    parts.forEach(part => {
      const highlighted = part.replace(/[a-zA-Z][-a-zA-Z]*(,\s*[a-zA-Z][-a-zA-Z]*)*/g, '<strong>$&</strong>');
      html += `<div class="day-title-item">${highlighted}</div>`;
    });
    html += '</div>';
    el.innerHTML = html;
    el.style.display = 'block';
  } else {
    el.innerHTML = '';
    el.style.display = 'none';
  }
}

function startStudy() {
  const order = document.getElementById('wordOrder').value;
  let pool = [...dayData[currentDayIndex].words];
  if (order === 'random') pool = shuffle(pool);
  studyWords = pool;
  currentIndex = 0;
  showCard();
}

function shuffle(arr) {
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [a[i], a[j]] = [a[j], a[i]]; }
  return a;
}

function showCard() {
  const word = studyWords[currentIndex]; if (!word) return;
  speakCount = 0;
  document.getElementById('cardWord').textContent = word.en;
  document.getElementById('cardIpa').textContent = word.ipa || '';
  const btnStar = document.getElementById('btnStar');
  if (isStarred(word.en)) { btnStar.textContent = 'â˜…'; btnStar.classList.add('starred'); }
  else { btnStar.textContent = 'â˜†'; btnStar.classList.remove('starred'); }
  let html = '';
  word.meanings.forEach(m => {
    html += `<div class="meaning-group"><span class="pos-tag">${m.pos}</span> <span class="def-inline">${m.defs.join(', ')}</span></div>`;
  });
  document.getElementById('cardMeanings').innerHTML = html;
  document.getElementById('cardCounter').textContent = `${currentIndex + 1} / ${studyWords.length}`;
  document.getElementById('btnFirst').disabled = currentIndex === 0;
  document.getElementById('btnPrev').disabled = currentIndex === 0;
  document.getElementById('btnNext').disabled = currentIndex >= studyWords.length - 1;
  document.getElementById('btnLast').disabled = currentIndex >= studyWords.length - 1;
}

function goFirst() { currentIndex = 0; showCard(); }
function goPrev() { if (currentIndex > 0) { currentIndex--; showCard(); } }
function goNext() { if (currentIndex < studyWords.length - 1) { currentIndex++; showCard(); } }
function goLast() { currentIndex = studyWords.length - 1; showCard(); }

function toggleSettings() { document.getElementById('settingsPanel').classList.toggle('open'); }
document.getElementById('settingsPanel').addEventListener('click', function(e) { if (e.target === this) toggleSettings(); });

document.addEventListener('keydown', function(e) {
  if (document.getElementById('settingsPanel').classList.contains('open')) return;
  if (document.getElementById('studyScreen').style.display === 'none') return;
  if (e.key === 'ArrowLeft') goPrev();
  if (e.key === 'ArrowRight') goNext();
  if (e.key === 'Home') goFirst();
  if (e.key === 'End') goLast();
  if (e.key === ' ') { e.preventDefault(); speakWord(null); }
  if (e.key === 'Escape' || e.key === 'Backspace') goBackToSelect();
});

loadAllDays();
</script>
</body>
</html>
